<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdragon: eepromfs.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libdragon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">eepromfs.h File Reference<div class="ingroups"><a class="el" href="group__libdragon.html">libdragon</a> &raquo; <a class="el" href="group__peripherals.html">Peripherals subsystem</a> &raquo; <a class="el" href="group__eeprom.html">EEPROM subsystem</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>EEPROM Filesystem.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
</div>
<p><a href="eepromfs_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structeepfs__entry__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#structeepfs__entry__t">eepfs_entry_t</a></td></tr>
<tr class="memdesc:structeepfs__entry__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">EEPROM filesystem configuration file entry.  <a href="eepromfs_8h.html#structeepfs__entry__t">More...</a><br /></td></tr>
<tr class="separator:structeepfs__entry__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">EEPROM filesystem return values</div></td></tr>
<tr class="memitem:acfe33ae0dc759e566e670e307d2225d9"><td class="memItemLeft" align="right" valign="top"><a id="acfe33ae0dc759e566e670e307d2225d9" name="acfe33ae0dc759e566e670e307d2225d9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EEPFS_ESUCCESS</b>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:acfe33ae0dc759e566e670e307d2225d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Success. <br /></td></tr>
<tr class="separator:acfe33ae0dc759e566e670e307d2225d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66961fdddda0998afe54f8cdd9845e4c"><td class="memItemLeft" align="right" valign="top"><a id="a66961fdddda0998afe54f8cdd9845e4c" name="a66961fdddda0998afe54f8cdd9845e4c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EEPFS_EBADINPUT</b>&#160;&#160;&#160;-1</td></tr>
<tr class="memdesc:a66961fdddda0998afe54f8cdd9845e4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Input parameters invalid. <br /></td></tr>
<tr class="separator:a66961fdddda0998afe54f8cdd9845e4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13af32c7614c4d58657b7d45daf7aea7"><td class="memItemLeft" align="right" valign="top"><a id="a13af32c7614c4d58657b7d45daf7aea7" name="a13af32c7614c4d58657b7d45daf7aea7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EEPFS_ENOFILE</b>&#160;&#160;&#160;-2</td></tr>
<tr class="memdesc:a13af32c7614c4d58657b7d45daf7aea7"><td class="mdescLeft">&#160;</td><td class="mdescRight">File does not exist. <br /></td></tr>
<tr class="separator:a13af32c7614c4d58657b7d45daf7aea7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa6deb922916e94dc53b877da2084d5b"><td class="memItemLeft" align="right" valign="top"><a id="aaa6deb922916e94dc53b877da2084d5b" name="aaa6deb922916e94dc53b877da2084d5b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EEPFS_EBADFS</b>&#160;&#160;&#160;-3</td></tr>
<tr class="memdesc:aaa6deb922916e94dc53b877da2084d5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Bad filesystem. <br /></td></tr>
<tr class="separator:aaa6deb922916e94dc53b877da2084d5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ef2b0ae7bb793fab3654345b3391fb1"><td class="memItemLeft" align="right" valign="top"><a id="a5ef2b0ae7bb793fab3654345b3391fb1" name="a5ef2b0ae7bb793fab3654345b3391fb1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EEPFS_ENOMEM</b>&#160;&#160;&#160;-4</td></tr>
<tr class="memdesc:a5ef2b0ae7bb793fab3654345b3391fb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">No memory for operation. <br /></td></tr>
<tr class="separator:a5ef2b0ae7bb793fab3654345b3391fb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63530fc25631632e16d6138424c3cd2b"><td class="memItemLeft" align="right" valign="top"><a id="a63530fc25631632e16d6138424c3cd2b" name="a63530fc25631632e16d6138424c3cd2b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EEPFS_EBADHANDLE</b>&#160;&#160;&#160;-5</td></tr>
<tr class="memdesc:a63530fc25631632e16d6138424c3cd2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invalid file handle. <br /></td></tr>
<tr class="separator:a63530fc25631632e16d6138424c3cd2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2103f842292166abcdca2f9fa051c295"><td class="memItemLeft" align="right" valign="top"><a id="a2103f842292166abcdca2f9fa051c295" name="a2103f842292166abcdca2f9fa051c295"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EEPFS_ECONFLICT</b>&#160;&#160;&#160;-6</td></tr>
<tr class="memdesc:a2103f842292166abcdca2f9fa051c295"><td class="mdescLeft">&#160;</td><td class="mdescRight">Filesystem already initialized. <br /></td></tr>
<tr class="separator:a2103f842292166abcdca2f9fa051c295"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a85e57900d8cccd4cce21a50273fe0662"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#a85e57900d8cccd4cce21a50273fe0662">eepfs_init</a> (const <a class="el" href="eepromfs_8h.html#structeepfs__entry__t">eepfs_entry_t</a> *entries, size_t count)</td></tr>
<tr class="memdesc:a85e57900d8cccd4cce21a50273fe0662"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the EEPROM filesystem.  <a href="eepromfs_8h.html#a85e57900d8cccd4cce21a50273fe0662">More...</a><br /></td></tr>
<tr class="separator:a85e57900d8cccd4cce21a50273fe0662"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dc04e21588af5d151c605ed8b383a86"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#a6dc04e21588af5d151c605ed8b383a86">eepfs_close</a> (void)</td></tr>
<tr class="memdesc:a6dc04e21588af5d151c605ed8b383a86"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-initializes the EEPROM filesystem.  <a href="eepromfs_8h.html#a6dc04e21588af5d151c605ed8b383a86">More...</a><br /></td></tr>
<tr class="separator:a6dc04e21588af5d151c605ed8b383a86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3daef0029a484a9a26aa7118c93d4473"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#a3daef0029a484a9a26aa7118c93d4473">eepfs_read</a> (const char *path, void *dest, size_t size)</td></tr>
<tr class="memdesc:a3daef0029a484a9a26aa7118c93d4473"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads an entire file from the EEPROM filesystem.  <a href="eepromfs_8h.html#a3daef0029a484a9a26aa7118c93d4473">More...</a><br /></td></tr>
<tr class="separator:a3daef0029a484a9a26aa7118c93d4473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e190ba715069bcda5d391699a4dfb43"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#a9e190ba715069bcda5d391699a4dfb43">eepfs_write</a> (const char *path, const void *src, size_t size)</td></tr>
<tr class="memdesc:a9e190ba715069bcda5d391699a4dfb43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes an entire file to the EEPROM filesystem.  <a href="eepromfs_8h.html#a9e190ba715069bcda5d391699a4dfb43">More...</a><br /></td></tr>
<tr class="separator:a9e190ba715069bcda5d391699a4dfb43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad18fa8a50b23c9f82ead1ea91781b491"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#ad18fa8a50b23c9f82ead1ea91781b491">eepfs_erase</a> (const char *path)</td></tr>
<tr class="memdesc:ad18fa8a50b23c9f82ead1ea91781b491"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erases a file in the EEPROM filesystem.  <a href="eepromfs_8h.html#ad18fa8a50b23c9f82ead1ea91781b491">More...</a><br /></td></tr>
<tr class="separator:ad18fa8a50b23c9f82ead1ea91781b491"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a352c89ef6e0adc23eba08938c39e7155"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#a352c89ef6e0adc23eba08938c39e7155">eepfs_verify_signature</a> (void)</td></tr>
<tr class="memdesc:a352c89ef6e0adc23eba08938c39e7155"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validates the first block of EEPROM.  <a href="eepromfs_8h.html#a352c89ef6e0adc23eba08938c39e7155">More...</a><br /></td></tr>
<tr class="separator:a352c89ef6e0adc23eba08938c39e7155"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae542838b659a911edd87d2f53d581517"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="eepromfs_8h.html#ae542838b659a911edd87d2f53d581517">eepfs_wipe</a> (void)</td></tr>
<tr class="memdesc:ae542838b659a911edd87d2f53d581517"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erases all blocks in EEPROM and sets a new signature.  <a href="eepromfs_8h.html#ae542838b659a911edd87d2f53d581517">More...</a><br /></td></tr>
<tr class="separator:ae542838b659a911edd87d2f53d581517"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >EEPROM Filesystem. </p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structeepfs__entry__t" id="structeepfs__entry__t"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structeepfs__entry__t">&#9670;&nbsp;</a></span>eepfs_entry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct eepfs_entry_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p >EEPROM filesystem configuration file entry. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="eepromfs_8h.html#a85e57900d8cccd4cce21a50273fe0662" title="Initializes the EEPROM filesystem.">eepfs_init</a> </dd></dl>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a6dcb30eea3da6cfa572b710b9bf22b32" name="a6dcb30eea3da6cfa572b710b9bf22b32"></a>const char *</td>
<td class="fieldname">
path</td>
<td class="fielddoc">
File path. <p >This cannot be NULL and must be a <code>\0</code>-terminated string.</p>
<p >There are no enforced limitations on directory structure or file naming conventions except that all paths within the filesystem must be unique and at least one character.</p>
<p >A leading '/' is optional and will be ignored if set.</p>
<p >The filesytem does not support entries for directories, nor does it support listing files in a given directory. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a87704f98ab950ec19e41369dec177b09" name="a87704f98ab950ec19e41369dec177b09"></a>size_t</td>
<td class="fieldname">
size</td>
<td class="fielddoc">
File size in bytes. <p >In order to make the most use of limited EEPROM space, files should be (but are not required to be) aligned to the 8-byte block size. Unaligned bytes at the end of a file will be wasted as padding; files must start on a block boundary.</p>
<p >The filesystem itself reserves the first block of EEPROM, so your total filesystem size cannot exceed the available EEPROM size minus 8 bytes (64 bits):</p>
<ul>
<li>4k EEPROM: 512 - 8 = 504 bytes (63 blocks) free.</li>
<li>16k EEPROM: 2048 - 8 = 2040 bytes (255 blocks) free. </li>
</ul>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6dc04e21588af5d151c605ed8b383a86" name="a6dc04e21588af5d151c605ed8b383a86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dc04e21588af5d151c605ed8b383a86">&#9670;&nbsp;</a></span>eepfs_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eepfs_close </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>De-initializes the EEPROM filesystem. </p>
<p >This cleans up the file lookup table.</p>
<p >You probably won't ever need to call this.</p>
<dl class="section return"><dt>Returns</dt><dd>EEPFS_ESUCCESS on success or a negative error otherwise </dd></dl>

</div>
</div>
<a id="ad18fa8a50b23c9f82ead1ea91781b491" name="ad18fa8a50b23c9f82ead1ea91781b491"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad18fa8a50b23c9f82ead1ea91781b491">&#9670;&nbsp;</a></span>eepfs_erase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eepfs_erase </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erases a file in the EEPROM filesystem. </p>
<p >Note that "erasing" a file just means writing it full of zeroes. All files in the filesystem must always exist at the size specified during <a class="el" href="eepromfs_8c.html#a85e57900d8cccd4cce21a50273fe0662" title="Initializes the EEPROM filesystem.">eepfs_init</a></p>
<p >Each EEPROM block write takes approximately 15 milliseconds; this operation may block for a while!</p>
<p >Be advised: this is a destructive operation that cannot be undone!</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EEPFS_ESUCCESS</td><td>if successful </td></tr>
    <tr><td class="paramname">EEPFS_ENOFILE</td><td>if the path is not a valid file </td></tr>
    <tr><td class="paramname">EEPFS_EBADINPUT</td><td>if the path is NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a85e57900d8cccd4cce21a50273fe0662" name="a85e57900d8cccd4cce21a50273fe0662"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85e57900d8cccd4cce21a50273fe0662">&#9670;&nbsp;</a></span>eepfs_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eepfs_init </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="eepromfs_8h.html#structeepfs__entry__t">eepfs_entry_t</a> *&#160;</td>
          <td class="paramname"><em>entries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the EEPROM filesystem. </p>
<p >Creates a lookup table of file descriptors based on the configuration and validates that the current EEPROM data is likely to be compatible with the configured file descriptors.</p>
<p >If the configured filesystem does not fit in the available EEPROM blocks on the cartridge, initialization will fail. Even if your total file size fits in EEPROM, your filesystem may not fit due to overhead and padding. Note that 1 block is reserved for the filesystem signature, and all files must start on a block boundary.</p>
<p >You can mitigate this by ensuring that your files are aligned to the 8-byte block size and minimizing wasted space with packed structs.</p>
<p >Each file will take up a minimum of 1 block, plus the filesystem itself reserves the first block of EEPROM, so the entry count has a practical limit of the number of available EEPROM blocks minus 1:</p>
<ul>
<li>4k EEPROM: 63 files maximum.</li>
<li>16k EEPROM: 255 files maximum.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">entries</td><td>An array of file paths and sizes; see <a class="el" href="eepromfs_8h.html#structeepfs__entry__t" title="EEPROM filesystem configuration file entry.">eepfs_entry_t</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">count</td><td>The number of entries in the array</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EEPFS_ESUCCESS on success or a negative error otherwise </dd></dl>

</div>
</div>
<a id="a3daef0029a484a9a26aa7118c93d4473" name="a3daef0029a484a9a26aa7118c93d4473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3daef0029a484a9a26aa7118c93d4473">&#9670;&nbsp;</a></span>eepfs_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eepfs_read </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads an entire file from the EEPROM filesystem. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">path</td><td>Path of file in EEPROM filesystem to read from </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dest</td><td>Buffer to read into </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of the destination buffer (in bytes)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EEPFS_ESUCCESS on success or a negative error otherwise </dd></dl>

</div>
</div>
<a id="a352c89ef6e0adc23eba08938c39e7155" name="a352c89ef6e0adc23eba08938c39e7155"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a352c89ef6e0adc23eba08938c39e7155">&#9670;&nbsp;</a></span>eepfs_verify_signature()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool eepfs_verify_signature </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Validates the first block of EEPROM. </p>
<p >There are no guarantees that the data in EEPROM actually matches the expected layout of the filesystem. There are many reasons why a mismatch can occur: EEPROM re-used from another game; a brand new EEPROM that has never been initialized and contains garbage data; the filesystem has changed between builds or version of software currently in development; EEPROM failing due to age or write limits.</p>
<p >To mitigate these scenarios, it is a good idea to validate that at least the first block of EEPROM matches some known good value.</p>
<p >If the signature matches, the data in EEPROM is probably what the filesystem expects. If not, the best move is to erase everything and start from zero.</p>
<dl class="section see"><dt>See also</dt><dd>eepfs_generate_signature </dd>
<dd>
<a class="el" href="eepromfs_8c.html#ae542838b659a911edd87d2f53d581517" title="Erases all blocks in EEPROM and sets a new signature.">eepfs_wipe</a></dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>if the signature in EEPROM matches the filesystem signature </td></tr>
    <tr><td class="paramname">false</td><td>if the signature in EEPROM does not match the filesystem signature </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae542838b659a911edd87d2f53d581517" name="ae542838b659a911edd87d2f53d581517"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae542838b659a911edd87d2f53d581517">&#9670;&nbsp;</a></span>eepfs_wipe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eepfs_wipe </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erases all blocks in EEPROM and sets a new signature. </p>
<p >This is useful when you want to erase all files in the filesystem.</p>
<p >Each EEPROM block write takes approximately 15 milliseconds; this operation may block for a while:</p>
<ul>
<li>4k EEPROM: 64 blocks * 15ms = 960ms!</li>
<li>16k EEPROM: 256 blocks * 15ms = 3840ms!</li>
</ul>
<p >You may want to pause audio in advance of calling this.</p>
<p >Be advised: this is a destructive operation that cannot be undone!</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="eepromfs_8c.html#a352c89ef6e0adc23eba08938c39e7155" title="Validates the first block of EEPROM.">eepfs_verify_signature</a> </dd></dl>

</div>
</div>
<a id="a9e190ba715069bcda5d391699a4dfb43" name="a9e190ba715069bcda5d391699a4dfb43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e190ba715069bcda5d391699a4dfb43">&#9670;&nbsp;</a></span>eepfs_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eepfs_write </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes an entire file to the EEPROM filesystem. </p>
<p >Each EEPROM block write takes approximately 15 milliseconds; this operation may block for a while!</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">path</td><td>Path of file in EEPROM filesystem to write to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>Buffer of data to be written </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of the source buffer (in bytes)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EEPFS_ESUCCESS on success or a negative error otherwise </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 7 2022 08:55:10 for libdragon by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
